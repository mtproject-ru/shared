## Цель встречи

- Определить требования к базе данных
    
- Спроектировать фичи и репозитории
    
- Ввести архитектуру авторизации
    
- Описать процесс разработки фич
    
- Определить подход к документированию и DevOps
    

---

## Фичи проекта

1. Пользователи
    
2. Авторизация
    
3. События
    
4. Дни
    
5. Комнаты
    

Общие требования:

- Для каждой модели пишутся DTO
    
- Для каждой фичи создаётся сервис
    
- Для каждой функции репозитория должен существовать эндпоинт
    

---

## База данных — Пользователи

### Особенности модели

- Индекс по `username` для ускорения поиска
    
- `id` создаётся через  
    `GENERATED BY DEFAULT AS IDENTITY`
    

### Репозиторий должен поддерживать

1. Создание пользователя
    
2. Получение по id
    
3. Получение по username
    
4. Проверку существования
    
5. Обновление
    
6. Удаление
    

### Структуры данных

**Ответ:**

- id
    
- username
    
- first_name
    
- last_name | null
    

**Запрос:**

- username
    
- first_name
    
- last_name | null
    
- password (сырой)
    

**Проверка существования:**

- id или username
    

---

## Авторизация (Backend)

Используется JWT с двумя токенами:

### Механика работы

1. После регистрации:
    
    - выдается access + refresh токен
        
2. Access токен:
    
    - отправляется в заголовке  
        `Authorization: Bearer`
        
    - используется для доступа к ресурсам
        
3. Если access истёк:
    
    - используется refresh
        
4. Если refresh истёк:
    
    - пользователь логинится заново
        

---

## Авторизация (Хранение токенов)

Refresh токены хранятся в Redis

- ключ — user id
    
- значение — refresh токен
    

Используется при перевыпуске access токена

Домашнее задание:

- изучить подключение Redis
    
- реализовать интеграцию
    

---

## База данных — События

### Задание

Создать миграцию таблицы

Выбрать формат:

- TIMESTAMP
    
- TIMESTAMPZ
    

### Репозиторий

- Получение события по:
    
    - id
        
    - created
        
    - start
        
- Обновление
    
- Удаление
    
- Создание:
    
    - с привязкой к дню
        
    - без привязки
        

### Visibility (ранее Mode)

- PUBLIC
    
- PROTECTED
    
- PRIVATE
    

Варианты реализации доступа:

1. Массив id пользователей
    
2. Отдельная реляционная таблица
    

Решение остаётся за разработчиком

---

## База данных — Дни

### Задание

Создать миграцию

Выбрать формат даты  
(без времени)

### Репозиторий

- Создание
    
- Изменение режима видимости
    
- Получение по id или date
    

---

## База данных — Комнаты

### Задание

Создать миграцию

Выбрать формат времени создания

### Репозиторий

- Создание
    
- Добавление дат
    
- Обновление имени
    
- Изменение видимости
    
- Удаление
    
- Получение дат комнаты
    
- Получение публичных комнат
    

RoomDates:

- массив дат PostgreSQL
    

---

## Реляции

Дополнения:

### Пользователь

- привязка дней
    
- получение дней пользователя
    

### День

- привязка событий
    
- получение событий
    

### Комната

- добавление пользователя
    
- получение пользователей
    

### Задания повышенной сложности

- количество событий пользователя
    
- количество событий комнаты
    
- получение событий комнаты с учетом visibility
    

---

## Процесс разработки фич

1️⃣ БД — модель + интерфейс  
Бэк — DTO + mapper

2️⃣ БД — миграции  
Бэк — сервис

3️⃣ БД — реализация репозитория

4️⃣ Тестирование БД

5️⃣ Тестирование сервиса

6️⃣ Контроллеры

7️⃣ Тестирование контроллеров

8️⃣ Завершение фичи

---

## Тестирование

- БД — стандартные инструменты Go
    
- Сервисы — Go тесты
    
- Контроллеры:
    
    - Postman коллекции
        
    - .http файлы (VSCode)
        

---

## Документирование API

Используется стандарт:

### OpenAPI

Генерация через:

- swag
    
- swaggo
    
- Fiber Swagger
    

Требуется:

- аннотировать хэндлеры
    
- документировать модели (домашнее задание)
    

---

## DevOps

Используем:

- Docker
    
- Docker Compose
    

### Режимы сервера

- production
    
- dev
    

В обоих:

- PostgreSQL
    
- Redis
    

В dev дополнительно:

- pgAdmin
    
- Redis Insight
    

Задание:

- написать Dockerfile
    

---

## Используемые инструменты

- go-redis — Redis клиент
    
- swag / swaggo — документация API
    
- Fiber Swagger — UI документации
    
- REST Client — тестирование запросов
    
- PostgreSQL arrays — работа с массивами
    

---

## Итог

Встреча определила:

- структуру и требования к БД
    
- модель авторизации
    
- процесс разработки фич
    
- стратегию тестирования
    
- стандарт документирования API
    
- базовую DevOps инфраструктуру
    

Цель — подготовить основу для полноценной разработки функционала проекта.
